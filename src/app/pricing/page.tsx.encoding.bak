// src/app/pricing/page.tsx

export const metadata = {
  title: 'Pricing â€” CareCircle',
  description: 'Free, Lite, and Elite plans for every family.',
};

type Plan = {
  name: string;
  price: string;
  features: string[];
  ctaColor: 'slate' | 'emerald' | 'sky';
  href?: string;
};

const env = {
  lite: process.env.NEXT_PUBLIC_STRIPE_PRICE_LITE || '',
  elite: process.env.NEXT_PUBLIC_STRIPE_PRICE_ELITE || '',
};

const rawPlans: Plan[] = [
  {
    name: 'ðŸŒ± Free',
    price: '$0 / month',
    ctaColor: 'slate',
    features: [
      'ðŸ‘¶ 1 kid',
      'ðŸ“… Family calendar (simple)',
      'âœ… Chores & reminders (basic)',
      'ðŸ’¬ Family chat (short history)',
      'ðŸ“ Map alerts (1â€“2 places)',
    ],
  },
  {
    name: 'ðŸŒŸ Lite',
    price: '$4.99 / month',
    ctaColor: 'emerald',
    features: [
      'ðŸ‘§ðŸ‘¦ 2 kids',
      'ðŸ“… Family calendar (better)',
      'âœ… Chores with photos',
      'ðŸ’¬ Family chat + short video check-ins',
      'ðŸ›’ Receipts & shopping lists (basic)',
      'ðŸ…¿ï¸ Parking helper (save car spot)',
      'ðŸ“ Map alerts (home & school)',
    ],
  },
  {
    name: 'ðŸš€ Elite',
    price: '$9.99 / month',
    ctaColor: 'sky',
    features: [
      'ðŸ‘©â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ Up to 5 kids (or more)',
      'ðŸ“… Super calendar (colors, smart reminders)',
      'âœ… Chores with smart nudges if kids forget',
      'ðŸ“² Text + push + phone-style alerts',
      'ðŸ’¬ Unlimited chat & longer live video check-ins',
      'ðŸ›’ Receipts, budgets, shopping lists (advanced)',
      'ðŸ…¿ï¸ Parking helper (car finder + save spot)',
      'ðŸ“‚ Safe folder for doctor notes & school forms',
      'ðŸ›¡ï¸ Family safety (parents/kids/relatives/caregivers with limits)',
      'ðŸ“± Parental controls (lock screen, pause internet, loud alert)',
      'ðŸš¨ Emergency help (fall alerts, SOS, loud alarm)',
      'â¤ï¸ Priority fixes & fastest help',
      '',
      'ðŸ§¼ ADL checklists + caregiver handoff',
      'â¤ï¸ Vital signs tracker (BP, heart, temp, Oâ‚‚, weight)',
      'ðŸŽ Diabetes logs (sugar numbers, insulin, food)',
      'ðŸ’Š Medicine helper & MAR (pill times, refills, export)',
      'ðŸ“ Daily care logs (notes + photos, reports)',
    ],
  },
];

function ctaClasses(color: Plan['ctaColor'], disabled?: boolean) {
  const base =
    'inline-flex w-full items-center justify-center rounded-lg px-4 py-2 text-white shadow transition focus:outline-none focus:ring-2 focus:ring-offset-2';
  const map: Record<Plan['ctaColor'], string> = {
    slate: 'bg-slate-800 hover:bg-slate-900 focus:ring-slate-800',
    emerald: 'bg-emerald-600 hover:bg-emerald-700 focus:ring-emerald-600',
    sky: 'bg-sky-600 hover:bg-sky-700 focus:ring-sky-600',
  };
  return [base, map[color], disabled ? 'pointer-events-none opacity-50' : ''].join(' ');
}

export default function PricingPage() {
  // Build plan links on the server
  const plans: Plan[] = rawPlans.map((p) => {
    if (p.name.includes('Lite')) {
      return { ...p, href: env.lite ? `/api/stripe/checkout?priceId=${env.lite}` : undefined };
    }
    if (p.name.includes('Elite')) {
      return { ...p, href: env.elite ? `/api/stripe/checkout?priceId=${env.elite}` : undefined };
    }
    return { ...p, href: '/' }; // Free -> home
  });

  return (
    <>
      {/* Header */}
      <header
        aria-label="Primary"
        className="sticky top-0 z-40 border-b bg-white/80 backdrop-blur supports-[backdrop-filter]:bg-white/60"
      >
        <div className="mx-auto flex h-14 max-w-6xl items-center justify-between px-6">
          <a href="/" className="font-semibold tracking-tight">CareCircle</a>
          <nav className="hidden gap-6 text-sm text-slate-700 sm:flex">
            <a href="/#features" className="hover:text-slate-900">Features</a>
            <a href="/pricing" className="hover:text-slate-900">Pricing</a>
            <a href="/admin" className="hover:text-slate-900">Admin</a>
            <a href="/#foundation" className="hover:text-slate-900">Foundation</a>
            <a href="/#faq" className="hover:text-slate-900">FAQ</a>
          </nav>
        </div>
      </header>

      {/* Back to Home */}
      <div className="mx-auto max-w-6xl px-6 py-4">
        <a href="/" className="inline-flex items-center text-sm font-medium text-emerald-700 hover:underline">
          â† Back to Home
        </a>
      </div>

      {/* Main pricing grid */}
      <main className="min-h-dvh bg-gray-50 py-8">
        <div className="mx-auto max-w-6xl px-6">
          <h1 className="mb-2 text-center text-3xl font-bold">CareCircle Plans</h1>
          <p className="mb-10 text-center text-slate-600">
            Transparent pricing. Cancel anytime. Test cards only â€” powered by Stripe Checkout.
          </p>

          <div className="grid gap-6 md:grid-cols-3">
            {plans.map((plan) => {
              const disabled = !plan.href;
              const cleanName = plan.name.replace(/[^a-zA-Z ]/g, '').trim() || 'Plan';
              return (
                <section
                  key={plan.name}
                  className="flex flex-col justify-between rounded-2xl border border-slate-200 bg-white p-6 shadow-sm"
                >
                  <div>
                    <h2 className="text-xl font-semibold">{plan.name}</h2>
                    <p className="mt-2 text-2xl font-bold">{plan.price}</p>
                    <ul className="mt-4 space-y-2 text-sm text-slate-700">
                      {plan.features.map((f, i) => (
                        <li key={i} className="flex items-start">
                          <span>{f}</span>
                        </li>
                      ))}
                    </ul>
                  </div>

                  <a
                    href={plan.href || '#'}
                    aria-disabled={disabled}
                    className={ctaClasses(plan.ctaColor, disabled) + ' mt-6'}
                  >
                    {cleanName === 'Free' ? 'Start Free' : `Choose ${cleanName}`}
                  </a>
                </section>
              );
            })}
          </div>
        </div>
      </main>

      {/* Footer */}
      <footer className="border-t">
        <div className="mx-auto flex max-w-6xl flex-col gap-2 px-6 py-8 text-sm text-slate-500 sm:flex-row sm:items-center sm:justify-between">
          <div>{new Date().getFullYear()} CareCircle</div>
          <nav className="flex gap-4">
            <a className="underline" href="/privacy">Privacy</a>
            <a className="underline" href="/terms">Terms</a>
          </nav>
        </div>
      </footer>
    </>
  );
}

